name: YouTube Downloader

on:
  workflow_dispatch:
    inputs:
      video_url:
        description: "YouTube video URL"
        required: true
        type: string
      format:
        description: "Output format (mp3 or mp4)"
        required: true
        default: "mp3"
        type: choice
        options:
          - mp3
          - mp4
      quality:
        description: "Video quality (1080p, 720p, 480p ‚Äî ignored for mp3)"
        required: false
        default: "720p"
        type: choice
        options:
          - 1080p
          - 720p
          - 480p

jobs:
  download:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Install yt-dlp and ffmpeg
        run: |
          sudo apt update
          sudo apt install -y ffmpeg
          python3 -m pip install -U yt-dlp

      - name: Download YouTube media
        run: |
          URL="${{ github.event.inputs.video_url }}"
          FORMAT="${{ github.event.inputs.format }}"
          QUALITY="${{ github.event.inputs.quality }}"
          
          echo "üé¨ Downloading from: $URL"
          mkdir -p output

          if [ "$FORMAT" = "mp3" ]; then
            echo "üéß Converting to MP3 (highest quality)"
            yt-dlp -x --audio-format mp3 --audio-quality 0 -o "output/%(title)s.%(ext)s" "$URL"
          else
            echo "üéûÔ∏è Downloading MP4 in ${QUALITY}"
            yt-dlp -f "bestvideo[height<=${QUALITY%%p}]+bestaudio/best[height<=${QUALITY%%p}]" \
                   -o "output/%(title)s.%(ext)s" "$URL"
          fi

          echo "‚úÖ Download complete."

      - name: Upload as artifact
        uses: actions/upload-artifact@v4
        with:
          name: youtube_result
          path: output/*
